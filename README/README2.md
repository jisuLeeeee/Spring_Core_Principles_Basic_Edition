# ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ê¸°ë³¸í¸

### <2023-11-23>

<aside>
ğŸš¨ ë‹¤ìŒì˜ ëª¨ë“  ë‚´ìš©ë“¤ì€ ê¹€ì˜í•œë‹˜ì˜ <b>â€œìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ê¸°ë³¸í¸"</b> ê°•ì˜ë¥¼ í† ëŒ€ë¡œ ì‘ì„±í•œ ê²ƒì…ë‹ˆë‹¤.

</aside>

## Section2 - ìŠ¤í”„ë§ì˜ í•µì‹¬ ì›ë¦¬ ì´í•´1 - ì˜ˆì œ ë§Œë“¤ê¸°

### ğŸ“í”„ë¡œì íŠ¸ ìƒì„±

ìŠ¤í”„ë§ì˜ ë„ì›€ ì—†ì´ ìˆœìˆ˜í•œ java ì½”ë“œë¡œ ê°œë°œí•´ë³´ê³  **ë‹¤í˜•ì„±, OCP, DIP ë“±ì´ ì˜ ì§€ì¼œì§€ëŠ”ì§€ í™•ì¸**í•˜ê³  ë¬¸ì œì ì´ ë°œìƒí•œë‹¤ë©´ ê°ì²´ ì§€í–¥ ì›ë¦¬ë¥¼ ì ìš©í•˜ë©´ì„œ í•´ê²°í•´ë³´ì

1. https://start.spring.io â‡’ ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤íƒ€í„° ì‚¬ì´íŠ¸ë¡œ ì´ë™í•´ì„œ ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ ìƒì„±
2. í”„ë¡œì íŠ¸ ì„ íƒ
    1. Project: Gradle - Groovy Project
       Spring Boot: 2.3.x
       Language: Java
       Packaging: Jar
       Java: 11
       Project Metadata
       groupId: hello
       artifactId: core
       Dependencies: ì„ íƒí•˜ì§€ ì•ŠìŒ
3. Gradle ëŒ€ì‹ ì—ì„œ IntelliJë¥¼ í†µí•´ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì‹¤í–‰ì†ë„ê°€ ë”ë¹ ë¥´ë¯€ë¡œ í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ ë³€ê²½í•´ì¤Œ

---

### ğŸ“ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ê³¼ ì„¤ê³„

- íšŒì›
    - íšŒì› ê°€ì…ê³¼ ì¡°íšŒ ê°€ëŠ¥
    - íšŒì›ì€ ì¼ë°˜ê³¼ VIP ë‘ ê°€ì§€ ë“±ê¸‰ì´ ìˆìŒ
    - íšŒì› ë°ì´í„°ëŠ” ìì²´ DBë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆê³ , ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ì—°ê²°í•  ìˆ˜ ìˆìŒ(ë¯¸í™•ì •)
- ì£¼ë¬¸ê³¼ í• ì¸ ì •ì±…
    - íšŒì›ì€ ìƒí’ˆì„ ì£¼ë¬¸í•  ìˆ˜ ìˆìŒ
    - íšŒì› ë“±ê¸‰ì— ë”°ë¼ í• ì¸ ì •ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŒ
    - í• ì¸ ì •ì±…ì€ ëª¨ë“  VIPëŠ” 1000ì›ì„ í• ì¸í•´ì£¼ëŠ” ê³ ì • ê¸ˆì•¡ í• ì¸ì„ ì ìš©í•´ë‹¬ë¼. (ë‚˜ì¤‘ì— ë³€ê²½ ë  ìˆ˜ ìˆìŒ)
    - í• ì¸ ì •ì±…ì€ ë³€ê²½ ê°€ëŠ¥ì„±ì´ ë†’ìŒ. íšŒì‚¬ì˜ ê¸°ë³¸ í• ì¸ ì •ì±…ì„ ì•„ì§ ì •í•˜ì§€ ëª»í–ˆê³ , ì˜¤í”ˆ ì§ì „ê¹Œì§€ ê³ ë¯¼ì„ ë¯¸ë£¨
      ê³  ì‹¶ìŒ. ìµœì•…ì˜ ê²½ìš° í• ì¸ì„ ì ìš©í•˜ì§€ ì•Šì„ ìˆ˜ ë„ ìˆìŒ (ë¯¸í™•ì •)

ìš”êµ¬ ì‚¬í•­ì—ì„œ íšŒì› ë°ì´í„°, í• ì¸ ì •ì±… ê°™ì€ ë¶€ë¶„ì€ ì§€ê¸ˆ ê²°ì •í•˜ê¸° ì–´ë ¤ìš´ ë¶€ë¶„ì´ì§€ë§Œ ê°œë°œì„ ë¬´ê¸°í•œ ê¸°ë‹¤ë¦´ ìˆ˜ë„ ì—†ê¸° ë•Œë¬¸ì— ì•ì„œ ë°°ìš´ ê°ì²´ ì§€í–¥ ì„¤ê³„ ë°©ë²•ìœ¼ë¡œ **ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  êµ¬í˜„ì²´ë¥¼ ì–¸ì œë“ ì§€ ê°ˆì•„ë¼ìš¸ ìˆ˜ ìˆë„ë¡ ì„¤ê³„**í•´ë³´ë ¤ê³ í•¨ !!

> ì°¸ê³ : í”„ë¡œì íŠ¸ í™˜ê²½ì„¤ì •ì„ í¸ë¦¬í•˜ê²Œ í•˜ë ¤ê³  ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œ ê²ƒì´ê³ , ì§€ê¸ˆì€ ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ ìë°”ë¡œë§Œ
ê°œë°œì„ ì§„í–‰í•œë‹¤ëŠ” ì ì„ ê¼­ ê¸°ì–µí•˜ì! ìŠ¤í”„ë§ ê´€ë ¨ì€ í•œì°¸ ë’¤ì— ë“±ì¥í•¨ !!!
>

---

### ğŸ“íšŒì› ë„ë©”ì¸ ì„¤ê³„

<img src="img/member_domain_relationship.png">

<img src="img/member_class_object_dia.png">

### ğŸ“íšŒì› ë„ë©”ì¸ ê°œë°œ

- íšŒì› ë“±ê¸‰ enum íƒ€ì…ìœ¼ë¡œ ìƒì„±

```java
package hello.core.member;

public enum Grade {
    BASIC,
    VIP
}
```

- íšŒì› ì—”í‹°í‹°

```java
package hello.core.member;

public class Member {
    private Long id;
    private String name;
    private Grade grade;

    public Member(Long id, String name, Grade grade) {
        this.id = id;
        this.name = name;
        this.grade = grade;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Grade getGrade() {
        return grade;
    }

    public void setGrade(Grade grade) {
        this.grade = grade;
    }
}
```

- íšŒì› ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤

```java
package hello.core.member;

public interface MemberRepository {
    void save(Member member);

    Member findById(Long memberId);
}
```

- DBê°€ ê²°ì •ë˜ì§€ ì•Šì•˜ì§€ë§Œ ê°œë°œì€ ì§„í–‰í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ê°€ì¥ ë‹¨ìˆœí•œ êµ¬í˜„ìœ¼ë¡œ member íŒ¨í‚¤ì§€ ì•ˆì— ì €ì¥ì†Œì™€ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ë¥¼ ì €ì¥í•¨
- ë©”ëª¨ë¦¬ íšŒì› ì €ì¥ì†Œ êµ¬í˜„ì²´

```java
package hello.core.member;

import java.util.HashMap;
import java.util.Map;

public class MemoryMemberRepository implements MemberRepository{

    private static Map<Long, Member> store = new HashMap<>();
    @Override
    public void save(Member member) {
        store.put(member.getId(), member);
    }

    @Override
    public Member findById(Long memberId) {
        return store.get(memberId);
    }
}
```

> ì°¸ê³  : HashMapì€ ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆì–´ì„œ ConcurrentHashMap ì‚¬ìš©ì„ ê¶Œì¥í•¨
>
- íšŒì› ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤

```java
package hello.core.member;

public interface MemberService {

    // íšŒì› ê°€ì…
    void join(Member member);
    // íšŒì› ì¡°íšŒ
    Member findMember(Long memberId);
}
```

- íšŒì› ì„œë¹„ìŠ¤ êµ¬í˜„ì²´

```java
package hello.core.member;

public class MemberServiceImpl implements MemberService{

    private final MemberRepository memberRepository = new MemoryMemberRepository();

    @Override
    public void join(Member member) {
// ë‹¤í˜•ì„±ì— ì˜í•´ì„œ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ MemoryMemberRepository í´ë˜ìŠ¤ì— ìˆëŠ” save ë©”ì†Œë“œ í˜¸ì¶œ
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

### ğŸ“íšŒì› ë„ë©”ì¸ ì‹¤í–‰ê³¼ í…ŒìŠ¤íŠ¸

- íšŒì› ê°€ì… - main

```java
package hello.core;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;

public class MemberApp {
    public static void main(String[] args) {
        MemberService memberService = new MemberServiceImpl();
        Member member = new Member(1L, "memberA", Grade.VIP);
        memberService.join(member);

        Member findMember = memberService.findMember(1L);
        System.out.println("new member = " + member.getName());
        System.out.println("findMember = " + findMember.getName());

    }

}
```

<img src="img/memberService_main.png">

ìœ„ ì½”ë“œ(ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§)ì²˜ëŸ¼ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆë¯€ë¡œ Junit í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•´ë³´ì

- íšŒì› ê°€ì… - test

```java
package hello.core.member;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;

public class MemberServiceTest {

    private MemberService memberService = new MemberServiceImpl();

    @Test
    void join(){
        // given
        Member member = new Member(1L, "memberA", Grade.VIP);
        // when
        memberService.join(member);
        Member findMember = memberService.findMember(1L);

        // then
        Assertions.assertThat(member).isEqualTo(findMember);

    }
}
```

<img src="img/memberService_test.png">

- ë‹¤ë¥¸ ì €ì¥ì†Œë¡œ ë³€ê²½í•  ë•Œ OCP ì›ì¹™ì„ ì˜ ì¤€ìˆ˜í• ê¹Œìš”?
- DIPë¥¼ ì˜ ì§€í‚¤ê³  ìˆì„ê¹Œìš”?
    - private final MemberRepository memberRepository = new MemoryMemberRepository(); â‡’ ì•„ë‹ˆìš” ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ ëª¨ë‘ë¥¼ ì˜ì¡´í•˜ê³  ìˆì–´ìš”
        - ì£¼ë¬¸ êµ¬í˜„ê¹Œì§€ ë§Œë“  í›„ í•´ê²° ë°©ì•ˆ ì„¤ëª…

### ğŸ“ì£¼ë¬¸ê³¼ í• ì¸ ë„ë©”ì¸ ì„¤ê³„

<img src="img/order_domain.png">

1. ì£¼ë¬¸ ìƒì„± : í´ë¼ì´ì–¸íŠ¸ëŠ” ì£¼ë¬¸ ì„œë¹„ìŠ¤ì— ì£¼ë¬¸ ìƒì„±ì„ ìš”ì²­
2. íšŒì› ì¡°íšŒ : í• ì¸ì„ ìœ„í•´ì„œëŠ” íšŒì› ë“±ê¸‰ì´ í•„ìš”í•´ì„œ ì£¼ë¬¸ ì„œë¹„ìŠ¤ëŠ” íšŒì› ì €ì¥ì†Œì— íšŒì›ì„ ì¡°íšŒ
3. í• ì¸ ì ìš© : ì£¼ë¬¸ ì„œë¹„ìŠ¤ëŠ” íšŒì› ë“±ê¸‰ì— ë”°ë¥¸ í• ì¸ ì—¬ë¶€ë¥¼ í• ì¸ ì •ì±…ì— ìœ„ì„
4. ì£¼ë¬¸ ê²°ê³¼ ë°˜í™˜ : ì£¼ë¬¸ ì„œë¹„ìŠ¤ëŠ” í• ì¸ ê²°ê³¼ë¥¼ í¬í•¨í•œ ì£¼ë¬¸ ê²°ê³¼ë¥¼ ë°˜í™˜

> ì°¸ê³  : ì‹¤ì œë¡œëŠ” ì£¼ë¬¸ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•˜ê² ì§€ë§Œ, ì˜ˆì œê°€ ë„ˆë¬´ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆì–´ì„œ ìƒëµí•˜ê³  ë‹¨ìˆœíˆ ì£¼ë¬¸ ê²°ê³¼ë¥¼ ë°˜í™˜
>

<img src="img/order_domain_class_dia.png">
<img src="img/order_domain_object_dia.png">

íšŒì›ì„ ë©”ëª¨ë¦¬ì—ì„œ ì¡°íšŒí•˜ê³ , ì •ì•¡ í• ì¸ ì •ì±…(ê³ ì • ê¸ˆì•¡)ì„ ì§€ì›í•´ë„ ì£¼ë¬¸ ì„œë¹„ìŠ¤ë¥¼ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ë¨, **ì—­í• ë“¤ì˜ í˜‘ë ¥ ê´€ê³„ë¥¼ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆìŒ**(= ë©”ëª¨ë¦¬ì—ì„œ DBë¡œ ë°”ë€Œê±°ë‚˜ ì •ì•¡ì—ì„œ ì •ë¥  í• ì¸ìœ¼ë¡œ ë°”ë€Œì–´ë„ ì£¼ë¬¸ ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŒ)

### ğŸ“ì£¼ë¬¸ê³¼ í• ì¸ ë„ë©”ì¸ ê°œë°œ

- í• ì¸ ì •ì±… ì¸í„°í˜ì´ìŠ¤

```java
package hello.core.discount;

import hello.core.member.Member;

public interface DiscountPolicy {

    /**
     *
     * @return í• ì¸ ëŒ€ìƒ ê¸ˆì•¡
     */
    int discount(Member member, int price);
}
```

- ì •ì•¡ í• ì¸ ì •ì±… êµ¬í˜„ì²´
- ë“±ê¸‰ì´ VIPì¼ ë•Œ í• ì¸ë˜ëŠ” ê¸ˆì•¡ 1000ì› ë°˜í™˜

```java
package hello.core.discount;

import hello.core.member.Grade;
import hello.core.member.Member;

public class FixDiscountPolicy implements DiscountPolicy{

    private int discountFixAmount = 1000; // 1000ì› í• ì¸
    @Override
    public int discount(Member member, int price) {
        if(member.getGrade() == Grade.VIP){
            return discountFixAmount;
        }
        else {
            return 0;
        }
    }
}
```

- í• ì¸ ì±…ì •ì´ ëœ í›„ ë¶ˆë ¤ì§€ëŠ” ì£¼ë¬¸ ì—”í‹°í‹°

```java
package hello.core.order;

public class Order {
    private Long memberId;
    private String itemName;
    private int itemPrice;
    private int discountPrice;

    public Order(Long memberId, String itemName, int itemPrice, int discountPrice) {
        this.memberId = memberId;
        this.itemName = itemName;
        this.itemPrice = itemPrice;
        this.discountPrice = discountPrice;
    }
		public int calculaterPrice(){
        return itemPrice - discountPrice;
    }

    public Long getMemberId() {
        return memberId;
    }

    public void setMemberId(Long memberId) {
        this.memberId = memberId;
    }

    public String getItemName() {
        return itemName;
    }

    public void setItemName(String itemName) {
        this.itemName = itemName;
    }

    public int getItemPrice() {
        return itemPrice;
    }

    public void setItemPrice(int itemPrice) {
        this.itemPrice = itemPrice;
    }

    public int getDiscountPrice() {
        return discountPrice;
    }

    public void setDiscountPrice(int discountPrice) {
        this.discountPrice = discountPrice;
    }
// order ê°ì²´ë¥¼ í˜¸ì¶œí•˜ë©´ ì¶œë ¥ë˜ëŠ” ë©”ì†Œë“œ
		@Override
    public String toString() {
        return "Order{" +
                "memberId=" + memberId +
                ", itemName='" + itemName + '\'' +
                ", itemPrice=" + itemPrice +
                ", discountPrice=" + discountPrice +
                '}';
    }
}
```

- ì£¼ë¬¸ ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤

```java
package hello.core.order;

public interface OrderService {
    Order createOrder(Long memberId, String itemName, int itemPrice);
}
```

<aside>
ã€°ï¸ Member member = memberRepository.findById(memberId);<br>
ì£¼ë¬¸ ìƒì„± ìš”ì²­ì´ ì˜¤ë©´ íšŒì› ì •ë³´ ì¡°íšŒ(ë“±ê¸‰ì„ ìœ„í•œ ì¡°íšŒ)<br>

</aside>

<aside>
ã€°ï¸ int discountPrice = discountPolicy.discount(member, itemPrice);<br>
í• ì¸ ì •ì±…ì— íšŒì› ê°ì²´ì™€ ìƒí’ˆ ê°€ê²©ì„ ë„˜ê¹€<br>

</aside>

<aside>
ã€°ï¸ return new Order(memberId, itemName, itemPrice, discountPrice);<br>
ìµœì¢… í• ì¸ ê¸ˆì•¡(=discountPrice)ì™€ í•¨ê»˜ ìµœì¢… ìƒì„±ëœ ì£¼ë¬¸ì„ ë°˜í™˜<br>

</aside>

- ì£¼ë¬¸ ì„œë¹„ìŠ¤ êµ¬í˜„ì²´
- ë©”ëª¨ë¦¬ íšŒì› ë¦¬í¬ì§€í† ë¦¬ì™€ ê³ ì • ê¸ˆì•¡ í• ì¸ ì €ì±…ì„ êµ¬í˜„ì²´ë¡œ ìƒì„±í•¨

```java
package hello.core.order;

import hello.core.discount.DiscountPolicy;
import hello.core.discount.FixDiscountPolicy;
import hello.core.member.Member;
import hello.core.member.MemberRepository;
import hello.core.member.MemoryMemberRepository;

public class OrderServiceImpl implements OrderService{

    private final MemberRepository memberRepository = new MemoryMemberRepository();
    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);

        return new Order(memberId, itemName, itemPrice, discountPrice);
    }
}
```

- ì£¼ë¬¸ í• ì¸ ì •ì±… ì‹¤í–‰ - main

```java
package hello.core;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.order.Order;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;

public class OrderApp {
    public static void main(String[] args) {
        MemberService memberService = new MemberServiceImpl();
        OrderService orderService = new OrderServiceImpl();

        Long memberId = 1L;
        Member member = new Member(memberId, "memberA", Grade.VIP);
        memberService.join(member);

        Order order = orderService.createOrder(memberId, "itemA", 10000);

        System.out.println("Order = " + order);
    }
}
```

<img src="img/order_application_result.png">

ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²ƒ ëŒ€ì‹  JUnit í…ŒìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ë³´ì

- ì£¼ë¬¸ê³¼ í• ì¸ ì •ì±… - test

```java
package hello.core.order;

import hello.core.member.Grade;
import hello.core.member.Member;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;

public class OrderServiceTest {

    MemberService memberService = new MemberServiceImpl();
    OrderService orderService = new OrderServiceImpl();

    @Test
    void createOrder(){
        Long memberId = 1L;
        Member member = new Member(memberId, "memberA", Grade.VIP);
        memberService.join(member);

        Order order = orderService.createOrder(memberId, "itemA", 10000);
        Assertions.assertThat(order.getDiscountPrice()).isEqualTo(1000);

    }
}
```

<img src="img/order_test_result.png">

> ìŠ¤í”„ë§ ì…ë¬¸ ê°•ì˜ì—ì„œ íšŒì› ì„œë¹„ìŠ¤ë¥¼ ìœ„ì™€ ê°™ì´ ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¡œ ìƒì„±í•´ë´ì„œ ìƒê°ë³´ë‹¤ ì´í•´ê°€ ì˜ ë˜ì—ˆë‹¤. ì¶”ê°€ë¡œ  ì£¼ë¬¸ê³¼ í• ì¸ ì—­í• ì„ ë‚˜ëˆ„ì–´ì„œ êµ¬í˜„í•´ë³´ë‹ˆ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì½”ë“œê°€ í˜ëŸ¬ê°€ëŠ”ì§€ ë” ëˆˆì— ë³´ì¸ë‹¤. ë‹¤ìŒ ê°•ì˜ì—ì„œëŠ” ì •ë¥  í• ì¸ ì •ì±… êµ¬í˜„ì²´ë¥¼ ìƒì„±í–ˆì„ ë•Œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ê²ƒì´ë‹¤.
>